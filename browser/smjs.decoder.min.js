!function(t,_){if("function"==typeof define&&define.amd)define(["exports"],function(_){t(_)});else if("undefined"!=typeof exports)t(exports);else{var e=_.SMJS;_.SMJS={noConflict:function(){return _.SMJS=e,this}},t(_.SMJS)}}(function(t){"use strict";function _(t){for(var _=n.length,e=t%_,T=Math.floor(t/_),i=n.charAt(e);T;)e=T%_,T=Math.floor(T/_),i=n.charAt(e)+i;return i}function e(t){var e=_(t);return e.length<2&&(e=n[0]+e),e}function T(t){for(var _=n.length,e=0,T=t.length,i=0;T>i;++i)e=e*_+n.indexOf(t.charAt(i));return e}function i(t){return encodeURIComponent(t.toString()).replace(/\'/g,"%27")}function r(t){return decodeURIComponent(t)}var s=t.COMMON={version:"0.0.1-alpha.1"},n="0123456789aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ-_.!~*()";s.d2r=_,s.d2r2=e,s.r2d=T,s.esc=i,s.unesc=r,s.AST_TOKEN="token",s.AST_NODE="node",s.AST_BODY="body",s.AST_ID="id",s.AST_LITERAL="literal",s.AST_OPERATOR="operator",s.AST_LEFT="left",s.AST_RIGHT="right",s.AST_ARGUMENTS="arguments",s.AST_INIT="init",s.AST_TEST="test",s.AST_UPDATE="update",s.AST_CATCH="catch",s.AST_FINALLY="finally",s.AST_ALT="alt",s.AST_OBJDEF="objdef",s.AST_VARDEF="vardef",s.AST_NODES={},s.T_END="'",s.T_1="1",s.T_2="2",s.T_3="3",s.T_4="4",s.T_5="5",s.T_6="6",s.T_7="7",s.T_8="8",s.T_9="9",s.T_ASSIGN="a",s.AST_NODES[s.T_ASSIGN]=[s.AST_OPERATOR,s.AST_LEFT,s.AST_RIGHT],s.T_ARRAY="A",s.AST_NODES[s.T_ARRAY]=[s.AST_BODY],s.T_BOP="b",s.AST_NODES[s.T_BOP]=[s.AST_OPERATOR,s.AST_LEFT,s.AST_RIGHT],s.T_BREAK="B",s.AST_NODES[s.T_BREAK]=[s.AST_ID],s.T_CALL="c",s.AST_NODES[s.T_CALL]=[s.AST_NODE,s.AST_ARGUMENTS],s.T_CONTINUE="C",s.AST_NODES[s.T_CONTINUE]=[s.AST_ID],s.T_EXPR="E",s.AST_NODES[s.T_EXPR]=[s.AST_NODE],s.T_FUNC="f",s.AST_NODES[s.T_FUNC]=[s.AST_ID,s.AST_ARGUMENTS,s.AST_NODE],s.T_FOR="F",s.AST_NODES[s.T_FOR]=[s.AST_INIT,s.AST_TEST,s.AST_UPDATE,s.AST_NODE],s.T_FOR_IN="g",s.AST_NODES[s.T_FOR_IN]=[s.AST_LEFT,s.AST_RIGHT,s.AST_NODE],s.T_THROW="G",s.AST_NODES[s.T_THROW]=[s.AST_NODE],s.T_TRY="h",s.AST_NODES[s.T_TRY]=[s.AST_NODE,s.AST_CATCH,s.AST_FINALLY],s.T_CATCH="H",s.AST_NODES[s.T_CATCH]=[s.AST_ID,s.AST_NODE],s.T_IF="I",s.AST_NODES[s.T_IF]=[s.AST_TEST,s.AST_NODE,s.AST_ALT],s.T_PREUPDATE="j",s.AST_NODES[s.T_PREUPDATE]=[s.AST_OPERATOR,s.AST_NODE],s.T_POSTUPDATE="J",s.AST_NODES[s.T_POSTUPDATE]=[s.AST_OPERATOR,s.AST_NODE],s.T_SWITCH="k",s.AST_NODES[s.T_SWITCH]=[s.AST_NODE,s.AST_BODY],s.T_SWITCH_CASE="K",s.AST_NODES[s.T_SWITCH_CASE]=[s.AST_TEST,s.AST_BODY],s.T_LITERAL="l",s.T_LITERAL_CODE="L",s.AST_NODES[s.T_LITERAL]=[s.AST_LITERAL],s.T_MEMBER="m",s.AST_NODES[s.T_MEMBER]=[s.AST_LEFT,s.AST_RIGHT],s.T_NEW="n",s.AST_NODES[s.T_NEW]=[s.AST_NODE,s.AST_ARGUMENTS],s.T_ORDER="o",s.AST_NODES[s.T_ORDER]=[s.AST_NODE],s.T_OBJECT="O",s.AST_NODES[s.T_OBJECT]=[s.AST_OBJDEF],s.T_ID="q",s.AST_NODES[s.T_ID]=[s.AST_ID],s.T_RETURN="r",s.AST_NODES[s.T_RETURN]=[s.AST_NODE],s.T_SEQ="S",s.AST_NODES[s.T_SEQ]=[s.AST_BODY],s.T_TABLE="t",s.T_THIS="T",s.AST_NODES[s.T_THIS]=[],s.T_UOP="u",s.AST_NODES[s.T_UOP]=[s.AST_OPERATOR,s.AST_NODE],s.T_VAR="v",s.AST_NODES[s.T_VAR]=[s.AST_VARDEF],s.T_DO_WHILE="V",s.AST_NODES[s.T_DO_WHILE]=[s.AST_NODE,s.AST_TEST],s.T_WHILE="w",s.AST_NODES[s.T_WHILE]=[s.AST_TEST,s.AST_NODE],s.T_WITH="W",s.AST_NODES[s.T_WITH]=[s.AST_NODE,s.AST_ALT],s.T_LABEL="z",s.AST_NODES[s.T_LABEL]=[s.AST_ID,s.AST_NODE],s.T_CONDITIONAL="Z",s.AST_NODES[s.T_CONDITIONAL]=[s.AST_TEST,s.AST_NODE,s.AST_ALT],s.T_EMPTY=".",s.AST_NODES[s.T_EMPTY]=[],s.T_NULL="!",s.T_BLOCK="(",s.AST_NODES[s.T_BLOCK]=[s.AST_BODY],s.LITERAL_CODE_TABLE=["undefined","null","true","false","NaN","Infinity","-Infinity","-","+","!","~","typeof","void","delete","==","!=","===","!==","<","<=",">",">=","<<",">>",">>>","*","/","%","|","^","&","in","instanceof","..","||","&&","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","|=","^=","&=","++","--"];var A=[].slice;s.astCreateNode=function(){var t=s.AST_NODES[arguments[0]];if(!t||arguments.length-1!==t.length)throw new Error("invalid createNode");return A.call(arguments)},s.astGetProp=function(t,_){var e=s.AST_NODES[t[0]];if(!e||t.length-1!==e.length)throw new Error("invalid node getProp");return t[e.indexOf(_)+1]}},this),function(t,_){"function"==typeof define&&define.amd?define(["exports","./common"],function(_,e){t(_,e.COMMON)}):"undefined"!=typeof exports?t(exports,require("./common").COMMON):t(_.SMJS,_.SMJS.COMMON)}(function(t,_){"use strict";function e(){}e.prototype.decode=function(t,e){if(this._reset(t),this._cbWrite=e,"CJS"!==this._get(3))throw new Error("This does not appear to be an cjs stream");var T=_.r2d(this._get(1));if(0!==T)throw new Error("This decoder only supports v0 cjs streams. Stream version found: "+T);for(var i=[],r=this._nextAst();r!==!1;)r!==!0&&i.push(r),r=this._nextAst();this._resetIds();for(var s=!0,n=0,A=i.length;A>n;++n)s?s=!1:this._cbWrite(";"),this._next(i[n])},e.prototype.decodeString=function(t){var _="";return this.decode(t,function(t){_+=t}),_},e.prototype._reset=function(t){this._cbWrite=null,this._code=t,this._pointer=0,this._resetIds()},e.prototype._resetIds=function(){this._ids=Object.create(null)},e.prototype._get=function(t){for(var _="";_.length<t;){if(this._pointer>=this._code.length)return!1;var e=this._code[this._pointer++];" "!==e&&"	"!==e&&"+"!==e&&"\r"!==e&&"\n"!==e&&(_+=e)}return _},e.prototype._peek=function(){return this._code[this._pointer]},e.prototype._getToEnd=function(){for(var t="",e=this._get(1);e&&e!=_.T_END;)t+=e,e=this._get(1);return t},e.prototype._nextAst=function(){var t,e=this._get(1);if(!e)return!1;if(e===_.T_NULL)return null;if(e===_.T_TABLE)return this._readTable(),this._nextAst();var T=!1;if(e===_.T_ID)return _.astCreateNode(_.T_ID,this._readIdCode());if("123456789".indexOf(e)>=0)return _.astCreateNode(_.T_ID,this._readSizedId(parseInt(e,10)));e===_.T_LITERAL_CODE&&(T=!0,e=_.T_LITERAL);var i=_.AST_NODES[e];if(!i)throw new Error('unexpected token: "'+e+'"');for(var r=[e],s=0,n=i.length;n>s;++s){var A=i[s];switch(A){case _.AST_OPERATOR:r.push(this._readLiteralCode());break;case _.AST_NODE:case _.AST_LEFT:case _.AST_RIGHT:case _.AST_INIT:case _.AST_TEST:case _.AST_UPDATE:case _.AST_ALT:case _.AST_CATCH:case _.AST_FINALLY:r.push(this._nextAst());break;case _.AST_BODY:case _.AST_ARGUMENTS:for(t=[];this._peek()!==_.T_END;)t.push(this._nextAst());this._get(1),r.push(t);break;case _.AST_ID:r.push(this._readId());break;case _.AST_LITERAL:r.push(T?this._readLiteralCode():_.unesc(this._getToEnd()));break;case _.AST_OBJDEF:for(t=[];this._peek()!==_.T_END;)t.push([this._nextAst(),this._nextAst()]);this._get(1),r.push(t);break;case _.AST_VARDEF:for(t=[];this._peek()!==_.T_END;)t.push([this._readId(),this._nextAst()]);this._get(1),r.push(t);break;default:throw new Error('unhandled nodeDef:type: "'+A+'"')}}return _.astCreateNode.apply(this,r)},e.prototype._readTable=function(){this._resetIds();for(var t=0,e=this._getToEnd();e.length;)this._ids[_.d2r2(t++)]=e,e=this._getToEnd()},e.prototype._readId=function(){this._peek()===_.T_TABLE&&(this._get(1),this._readTable());var t=this._get(1);return t===_.T_ID?this._readIdCode():"123456789".indexOf(t)>=0?this._readSizedId(parseInt(t,10)):void 0},e.prototype._readIdCode=function(){return this._peek()===_.T_END?(this._get(1),null):this._ids[this._get(2)]},e.prototype._readSizedId=function(t){return _.unesc(this._get(t))},e.prototype._readLiteralCode=function(){return _.LITERAL_CODE_TABLE[_.r2d(this._get(1))]},e.prototype._next=function(t){if(!(t[0]in this._map))throw new Error('Unhandled token: "'+t[0]+'"');this._map[t[0]].call(this,t)};var T=e.prototype._map={};T[_.T_ASSIGN]=T[_.T_BOP]=function(t){this._next(_.astGetProp(t,_.AST_LEFT)),this._cbWrite(" "+_.astGetProp(t,_.AST_OPERATOR)+" "),this._next(_.astGetProp(t,_.AST_RIGHT))},T[_.T_ARRAY]=function(t){var e=_.astGetProp(t,_.AST_BODY);this._cbWrite("[");for(var T=!0,i=0,r=e.length;r>i;++i)T?T=!1:this._cbWrite(","),this._next(e[i]);this._cbWrite("]")},T[_.T_BREAK]=function(t){this._cbWrite("break");var e=_.astGetProp(t,_.AST_ID);null!==e&&(this._cbWrite(" "),this._cbWrite(e)),this._cbWrite(";")},T[_.T_CALL]=function(t){this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite("(");for(var e=!0,T=_.astGetProp(t,_.AST_ARGUMENTS),i=0,r=T.length;r>i;++i)e?e=!1:this._cbWrite(","),this._next(T[i]);this._cbWrite(")")},T[_.T_CONTINUE]=function(t){this._cbWrite("continue");var e=_.astGetProp(t,_.AST_ID);null!==e&&(this._cbWrite(" "),this._cbWrite(e)),this._cbWrite(";")},T[_.T_EXPR]=function(t){this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite(";")},T[_.T_FUNC]=function(t){this._cbWrite("function ");var e=_.astGetProp(t,_.AST_ID);null!==e&&this._cbWrite(e),this._cbWrite("(");for(var T=_.astGetProp(t,_.AST_ARGUMENTS),i=!0,r=0,s=T.length;s>r;++r)i?i=!1:this._cbWrite(","),this._next(T[r]);this._cbWrite(")"),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_FOR]=function(t){var e=_.astGetProp(t,_.AST_INIT),T=_.astGetProp(t,_.AST_TEST),i=_.astGetProp(t,_.AST_UPDATE),r=_.astGetProp(t,_.AST_NODE);this._cbWrite("for("),e&&this._next(e),this._cbWrite(";"),T&&this._next(T),this._cbWrite(";"),i&&this._next(i),this._cbWrite(")"),this._next(r)},T[_.T_FOR_IN]=function(t){this._cbWrite("for("),this._next(_.astGetProp(t,_.AST_LEFT)),this._cbWrite(" in "),this._next(_.astGetProp(t,_.AST_RIGHT)),this._cbWrite(")"),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_THROW]=function(t){this._cbWrite("throw "),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_TRY]=function(t){this._cbWrite("try "),this._next(_.astGetProp(t,_.AST_NODE));var e=_.astGetProp(t,_.AST_CATCH),T=_.astGetProp(t,_.AST_FINALLY);e&&this._next(e),T&&(this._cbWrite("finally "),this._next(T))},T[_.T_CATCH]=function(t){this._cbWrite("catch (");var e=_.astGetProp(t,_.AST_ID);null!==e&&this._cbWrite(e),this._cbWrite(")"),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_IF]=function(t){this._cbWrite("if("),this._next(_.astGetProp(t,_.AST_TEST)),this._cbWrite(")"),this._next(_.astGetProp(t,_.AST_NODE));var e=_.astGetProp(t,_.AST_ALT);null!==e&&(this._cbWrite(" else "),this._next(e))},T[_.T_PREUPDATE]=function(t){this._cbWrite(_.astGetProp(t,_.AST_OPERATOR)),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_POSTUPDATE]=function(t){this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite(_.astGetProp(t,_.AST_OPERATOR))},T[_.T_SWITCH]=function(t){this._cbWrite("switch("),this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite("){");for(var e=_.astGetProp(t,_.AST_BODY),T=0,i=e.length;i>T;++T)this._next(e[T]);this._cbWrite("}\n")},T[_.T_SWITCH_CASE]=function(t){var e=_.astGetProp(t,_.AST_TEST);null===e?this._cbWrite("default: "):(this._cbWrite("case "),this._next(e),this._cbWrite(": "));for(var T=_.astGetProp(t,_.AST_BODY),i=!0,r=0,s=T.length;s>r;++r)i?i=!1:this._cbWrite(";"),this._next(T[r])},T[_.T_LITERAL]=function(t){this._cbWrite(_.astGetProp(t,_.AST_LITERAL))},T[_.T_MEMBER]=function(t){this._next(_.astGetProp(t,_.AST_LEFT));var e=_.astGetProp(t,_.AST_RIGHT);e[0]===_.T_ID?(this._cbWrite("."),this._next(e)):(this._cbWrite("["),this._next(e),this._cbWrite("]"))},T[_.T_NEW]=function(t){this._cbWrite("new "),this._next(_.astGetProp(t,_.AST_NODE));var e=_.astGetProp(t,_.AST_ARGUMENTS);if(e.length){this._cbWrite("(");for(var T=!0,i=0,r=e.length;r>i;++i)T?T=!1:this._cbWrite(","),this._next(e[i]);this._cbWrite(")")}},T[_.T_ORDER]=function(t){this._cbWrite("("),this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite(")")},T[_.T_OBJECT]=function(t){var e=_.astGetProp(t,_.AST_OBJDEF);this._cbWrite("{");for(var T=!0,i=0,r=e.length;r>i;++i)T?T=!1:this._cbWrite(","),this._next(e[i][0]),this._cbWrite(":"),this._next(e[i][1]);this._cbWrite("}")},T[_.T_ID]=function(t){this._cbWrite(_.astGetProp(t,_.AST_ID))},T[_.T_RETURN]=function(t){var e=_.astGetProp(t,_.AST_NODE);null===e?this._cbWrite("return;"):(this._cbWrite("return "),this._next(e),this._cbWrite(";"))},T[_.T_SEQ]=function(t){for(var e=_.astGetProp(t,_.AST_BODY),T=!0,i=0,r=e.length;r>i;++i)T?T=!1:this._cbWrite(","),this._next(e[i])},T[_.T_THIS]=function(){this._cbWrite("this")},T[_.T_UOP]=function(t){this._cbWrite(_.astGetProp(t,_.AST_OPERATOR)+" "),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_VAR]=function(t){this._cbWrite("var ");for(var e=_.astGetProp(t,_.AST_VARDEF),T=!0,i=0,r=e.length;r>i;++i)T?T=!1:this._cbWrite(","),this._cbWrite(e[i][0]),null!==e[i][1]&&(this._cbWrite(" = "),this._next(e[i][1]))},T[_.T_DO_WHILE]=function(t){this._cbWrite("do "),this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite(" while ("),this._next(_.astGetProp(t,_.AST_TEST)),this._cbWrite(")")},T[_.T_WHILE]=function(t){this._cbWrite("while("),this._next(_.astGetProp(t,_.AST_TEST)),this._cbWrite(")"),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_WITH]=function(t){this._cbWrite("with ("),this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite(")"),this._next(_.astGetProp(t,_.AST_ALT))},T[_.T_LABEL]=function(t){this._cbWrite(_.astGetProp(t,_.AST_ID)),this._cbWrite(":"),this._next(_.astGetProp(t,_.AST_NODE))},T[_.T_CONDITIONAL]=function(t){this._next(_.astGetProp(t,_.AST_TEST)),this._cbWrite(" ? "),this._next(_.astGetProp(t,_.AST_NODE)),this._cbWrite(" : "),this._next(_.astGetProp(t,_.AST_ALT))},T[_.T_EMPTY]=function(){this._cbWrite(";")},T[_.T_BLOCK]=function(t){this._cbWrite("{");for(var e=_.astGetProp(t,_.AST_BODY),T=!0,i=0,r=e.length;r>i;++i)T?T=!1:this._cbWrite(";"),this._next(e[i]);this._cbWrite("}\n")},t.Decoder=e},this);